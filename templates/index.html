<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <link rel="icon" href="https://raw.githubusercontent.com/Toperlock/sing-box-subscribe/main/public/favicon.ico"
        type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/templates/css/main.css">
    <title>SING-BOX</title>
</head>

<body>
    <section id="canvas-show" class="canvas-wrap">
        <div id="canvas" class="gradient"></div>
    </section>
    <div id="app"></div>
    <script src="/templates/js/jquery.min.js"></script>
    <!-- <script src="/js/three.min.js"></script> -->
    <script src="/templates/js/projector.js"></script>
    <script src="/templates/js/canvas-renderer.js"></script>
    <script src="/templates/js/projector.js"></script>
    <script src="/templates/js/3d-lines-animation.js"></script>
    <div id="container">
        <!-- <div class="left-box">
            <h1>Providers JSON 模板</h1>
            <form id="providers-form" method="POST" action="/update_providers">
                <textarea name="providers_data" rows="10" cols="40" style="width: 400px; height: 400px;">{{ providers_data | safe }}</textarea>
                <br>
            </form>
        </div> -->

        <div class="content">
            <div class="header">
                <h1>SING-BOX VIEFAST</h1>
            </div>
            <div class="main">
                <form id="temp-json-form" method="POST" action="/edit_temp_json">
                    <textarea name="temp_json_data" rows="10" cols="40"
                        style="width: 100%; height: 400px;">{{ temp_json_data | default('') }}</textarea>
                    <br>
                    <input type="submit" class="btn btn-primary mb-3" value="save">
                </form>

                <!-- <button onclick="toggleLanguage()">Switch Language</button> -->
                <!-- <div class="sidebar"> -->
                <form method="POST" action="/generate_config">
                    <select class="form-select form-select-lg mb-3" name="template_index">
                        {% for option in template_options %}
                        <option value="{{ loop.index - 1 }}">{{ option }}</option>
                        {% endfor %}
                    </select>
                    <input type="submit" class="btn btn-primary mb-3" value="Select and Generate">
                </form>
            </div>
            <!-- </div> -->
        </div>
        <div class="config-content">
            <pre id="config-text"></pre>
        </div>
    </div>
    <script>
        const initialTempJsonData = '{"subscribes":[{"url":"URLLINK","tag":"tag_1","enabled":true,"emoji":1,"prefix":"","User-Agent":"v2rayng"}],"auto_set_outbounds_dns":{"proxy":"","direct":""},"save_config_path":"./config.json","auto_backup":false,"exclude_protocol":"ssr","config_template":"","Only-nodes":false}';
        let tempJsonData = initialTempJsonData;
        document.querySelector('#temp-json-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const response = await fetch(form.action, {
                method: form.method,
                body: formData,
            });
            if (response.ok) {
                const responseData = await response.text();
                const configContent = document.querySelector('#config-text');
                configContent.textContent = responseData
            }
        });
        const languageData = {
            "1": "Please be sure to: Click to view operation instructions.",
            "2": "Please be sure to: Click to view parameter meanings.",
            "3": "Fill in the subscription link within the quotes '', and be careful not to have line breaks at the end of the subscription link, as this can be easily overlooked!!!",
            "4": "Reminder: After clicking save, please immediately generate the configuration file!!!",
            "5": "Otherwise, others will be able to see the content of your saved TEMP_JSON_DATA.",
            "6": "The 'subscription link' starts with 'http://' and includes node information for v2/clash links or is a single URI node link starting with 'vmess://', 'hysteria2://', and similar.",
            "7": "subscription links provided by Service can be directly opened in the browser, and the script can use them. Please check if it works on your end.",
            "8": "For subscription links that require a special environment to open, please modify 'User-Agent' in TEMP_JSON_DATA, or copy the content of the airport subscription link to gist in advance for the script to parse successfully. Alternatively, run the script locally.",
            "9": "Failed due to vercel server instability, please try again. Or run the script locally.",
            "10": "If there is a new hy2 protocol in the sub link, please modify 'User-Agent' to: clashmeta.",
            "11": "The above is not nonsense; if you fail to generate the configuration successfully, please read the above content carefully.",
            "12": "Because there is no database used, it will not return a configuration file link. After generating the configuration content, copy it to gist as a sing-box remote link.",
            "13": "After successfully generating the configuration, please do not use third-party input methods to copy the content, as there may be length limitations and the copy may not be complete.",
            "14": "Please open an issue on github if you encounter problems.",
            // 添加其他翻译...
        };
        let isEnglish = false; // 初始状态为中文

        function toggleLanguage() {
            isEnglish = !isEnglish;
            const elementsToTranslate = document.querySelectorAll('[data-translate]');

            elementsToTranslate.forEach(element => {
                const key = element.getAttribute('data-translate');
                const originalColor = element.getAttribute('data-color');
                const originalLink = element.getAttribute('data-link');

                if (isEnglish && languageData[key]) {
                    if (element.tagName === 'A') {
                        element.href = languageData[key];
                    } else {
                        // 处理 <span> 元素
                        const spanElement = element.querySelector('span');
                        if (spanElement) {
                            spanElement.textContent = languageData[key];
                            spanElement.style.color = originalColor;
                            spanElement.setAttribute('data-link', languageData[key]);
                        } else {
                            element.textContent = languageData[key];
                            element.style.color = originalColor;
                        }
                    }
                } else {
                    if (element.tagName === 'A') {
                        element.href = originalLink;
                    } else {
                        // 如果需要，可以添加其他语言的支持
                        window.location.reload();
                    }
                }
            });
        }
    </script>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <ul class="flashes">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}
</body>

</html>